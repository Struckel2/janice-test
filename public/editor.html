<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Imagens - Janice</title>
    <link rel="stylesheet" href="/css/editor.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Fabric.js para manipulação de canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <!-- FileSaver.js para download de arquivos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="editor-container">
        <header class="editor-header">
            <div class="logo-section">
                <h1>Editor de Imagens</h1>
            </div>
            <div class="actions-section">
                <button id="save-btn" class="action-button primary">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <button id="download-btn" class="action-button secondary">
                    <i class="fas fa-download"></i> Download
                </button>
                <button id="back-btn" class="action-button">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
            </div>
        </header>

        <div class="editor-main">
            <div class="tools-panel">
                <!-- Seção de IA - Nova seção principal -->
                <div class="ai-edit-panel">
                    <h3 class="panel-title">Editar com IA</h3>
                    <div class="panel-content">
                        <div class="form-group">
                            <label for="ai-prompt">Descreva a mudança desejada:</label>
                            <textarea id="ai-prompt" rows="3" placeholder="Ex: Mude o fundo para azul, adicione um logo no canto superior direito..."></textarea>
                        </div>
                        <div class="form-group">
                            <button id="apply-ai-edit" class="action-button primary">
                                <i class="fas fa-magic"></i> Aplicar Edição com IA
                            </button>
                        </div>
                        <div id="ai-processing" style="display: none;">
                            <div class="spinner"></div>
                            <p>Processando sua solicitação...</p>
                            <p class="progress-message">Isso pode levar alguns segundos.</p>
                        </div>
                        <div id="ai-result" style="display: none;">
                            <h4>Resultado:</h4>
                            <div class="ai-result-preview"></div>
                            <div class="form-group">
                                <button id="accept-ai-result" class="action-button primary">
                                    <i class="fas fa-check"></i> Aceitar
                                </button>
                                <button id="reject-ai-result" class="action-button">
                                    <i class="fas fa-times"></i> Rejeitar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ferramentas - Agora como seção colapsável -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h3>Ferramentas</h3>
                        <span class="toggle-icon"></span>
                    </div>
                    <div class="collapsible-content">
                        <div class="tool-group">
                            <button id="select-tool" class="tool-button active" title="Selecionar">
                                <i class="fas fa-mouse-pointer"></i>
                            </button>
                            <button id="crop-tool" class="tool-button" title="Recortar">
                                <i class="fas fa-crop-alt"></i>
                            </button>
                            <button id="rotate-tool" class="tool-button" title="Rotacionar">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="text-tool" class="tool-button" title="Adicionar Texto">
                                <i class="fas fa-font"></i>
                            </button>
                            <button id="draw-tool" class="tool-button" title="Desenhar">
                                <i class="fas fa-paint-brush"></i>
                            </button>
                            <button id="shape-tool" class="tool-button" title="Formas">
                                <i class="fas fa-shapes"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ajustes - Como seção colapsável -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h3>Ajustes</h3>
                        <span class="toggle-icon"></span>
                    </div>
                    <div class="collapsible-content">
                        <div class="tool-group">
                            <button id="brightness-tool" class="tool-button" title="Brilho">
                                <i class="fas fa-sun"></i>
                            </button>
                            <button id="contrast-tool" class="tool-button" title="Contraste">
                                <i class="fas fa-adjust"></i>
                            </button>
                            <button id="saturation-tool" class="tool-button" title="Saturação">
                                <i class="fas fa-palette"></i>
                            </button>
                            <button id="blur-tool" class="tool-button" title="Desfoque">
                                <i class="fas fa-tint"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filtros - Como seção colapsável -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h3>Filtros</h3>
                        <span class="toggle-icon"></span>
                    </div>
                    <div class="collapsible-content">
                        <div class="tool-group">
                            <button id="filter-none" class="filter-button active" title="Normal">
                                Normal
                            </button>
                            <button id="filter-grayscale" class="filter-button" title="Preto e Branco">
                                P&B
                            </button>
                            <button id="filter-sepia" class="filter-button" title="Sépia">
                                Sépia
                            </button>
                            <button id="filter-vintage" class="filter-button" title="Vintage">
                                Vintage
                            </button>
                            <button id="filter-vibrant" class="filter-button" title="Vibrante">
                                Vibrante
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ações - Como seção colapsável -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <h3>Ações</h3>
                        <span class="toggle-icon"></span>
                    </div>
                    <div class="collapsible-content">
                        <div class="tool-group">
                            <button id="undo-btn" class="action-button" title="Desfazer" disabled>
                                <i class="fas fa-undo"></i> Desfazer
                            </button>
                            <button id="redo-btn" class="action-button" title="Refazer" disabled>
                                <i class="fas fa-redo"></i> Refazer
                            </button>
                            <button id="reset-btn" class="action-button" title="Resetar">
                                <i class="fas fa-trash"></i> Resetar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <div id="loading-overlay">
                    <div class="spinner"></div>
                    <p>Carregando imagem...</p>
                </div>
                <canvas id="editor-canvas"></canvas>
            </div>

            <div class="properties-panel">
                <div class="panel-content">
                    <h3>Propriedades</h3>
                    <div id="no-selection-message">
                        <p>Selecione um elemento para editar suas propriedades</p>
                    </div>

                    <!-- Propriedades de texto (visível apenas quando texto selecionado) -->
                    <div id="text-properties" class="property-group" style="display: none;">
                        <h4>Texto</h4>
                        <div class="form-group">
                            <label for="text-content">Conteúdo:</label>
                            <textarea id="text-content" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="text-font">Fonte:</label>
                            <select id="text-font">
                                <option value="Arial">Arial</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Impact">Impact</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="text-size">Tamanho:</label>
                            <input type="range" id="text-size" min="10" max="100" value="30">
                            <span id="text-size-value">30px</span>
                        </div>
                        <div class="form-group">
                            <label for="text-color">Cor:</label>
                            <input type="color" id="text-color" value="#000000">
                        </div>
                        <div class="form-group">
                            <label>Estilo:</label>
                            <div class="button-group">
                                <button id="text-bold" class="style-button" title="Negrito">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button id="text-italic" class="style-button" title="Itálico">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button id="text-underline" class="style-button" title="Sublinhado">
                                    <i class="fas fa-underline"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Alinhamento:</label>
                            <div class="button-group">
                                <button id="text-align-left" class="style-button active" title="Alinhar à Esquerda">
                                    <i class="fas fa-align-left"></i>
                                </button>
                                <button id="text-align-center" class="style-button" title="Centralizar">
                                    <i class="fas fa-align-center"></i>
                                </button>
                                <button id="text-align-right" class="style-button" title="Alinhar à Direita">
                                    <i class="fas fa-align-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Propriedades de forma (visível apenas quando forma selecionada) -->
                    <div id="shape-properties" class="property-group" style="display: none;">
                        <h4>Forma</h4>
                        <div class="form-group">
                            <label for="shape-color">Cor de Preenchimento:</label>
                            <input type="color" id="shape-color" value="#3498db">
                        </div>
                        <div class="form-group">
                            <label for="shape-border-color">Cor da Borda:</label>
                            <input type="color" id="shape-border-color" value="#2980b9">
                        </div>
                        <div class="form-group">
                            <label for="shape-border-width">Espessura da Borda:</label>
                            <input type="range" id="shape-border-width" min="0" max="20" value="1">
                            <span id="shape-border-width-value">1px</span>
                        </div>
                        <div class="form-group">
                            <label for="shape-opacity">Opacidade:</label>
                            <input type="range" id="shape-opacity" min="0" max="100" value="100">
                            <span id="shape-opacity-value">100%</span>
                        </div>
                    </div>

                    <!-- Propriedades de desenho (visível apenas quando ferramenta de desenho ativa) -->
                    <div id="draw-properties" class="property-group" style="display: none;">
                        <h4>Desenho</h4>
                        <div class="form-group">
                            <label for="brush-color">Cor:</label>
                            <input type="color" id="brush-color" value="#000000">
                        </div>
                        <div class="form-group">
                            <label for="brush-width">Espessura:</label>
                            <input type="range" id="brush-width" min="1" max="50" value="5">
                            <span id="brush-width-value">5px</span>
                        </div>
                    </div>

                    <!-- Propriedades de imagem (visível apenas quando imagem selecionada) -->
                    <div id="image-properties" class="property-group" style="display: none;">
                        <h4>Imagem</h4>
                        <div class="form-group">
                            <label for="image-opacity">Opacidade:</label>
                            <input type="range" id="image-opacity" min="0" max="100" value="100">
                            <span id="image-opacity-value">100%</span>
                        </div>
                        <div class="form-group">
                            <button id="flip-horizontal" class="action-button">
                                <i class="fas fa-arrows-alt-h"></i> Espelhar Horizontal
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="flip-vertical" class="action-button">
                                <i class="fas fa-arrows-alt-v"></i> Espelhar Vertical
                            </button>
                        </div>
                    </div>

                    <!-- Propriedades de ajustes (visível apenas quando ajustes selecionados) -->
                    <div id="adjustment-properties" class="property-group" style="display: none;">
                        <h4>Ajustes</h4>
                        <div class="form-group">
                            <label for="brightness-value">Brilho:</label>
                            <input type="range" id="brightness-value" min="-100" max="100" value="0">
                            <span id="brightness-value-display">0</span>
                        </div>
                        <div class="form-group">
                            <label for="contrast-value">Contraste:</label>
                            <input type="range" id="contrast-value" min="-100" max="100" value="0">
                            <span id="contrast-value-display">0</span>
                        </div>
                        <div class="form-group">
                            <label for="saturation-value">Saturação:</label>
                            <input type="range" id="saturation-value" min="-100" max="100" value="0">
                            <span id="saturation-value-display">0</span>
                        </div>
                        <div class="form-group">
                            <label for="blur-value">Desfoque:</label>
                            <input type="range" id="blur-value" min="0" max="10" value="0" step="0.1">
                            <span id="blur-value-display">0</span>
                        </div>
                        <div class="form-group">
                            <button id="apply-adjustments" class="action-button primary">
                                <i class="fas fa-check"></i> Aplicar Ajustes
                            </button>
                        </div>
                    </div>

                    <!-- Propriedades de recorte (visível apenas quando ferramenta de recorte ativa) -->
                    <div id="crop-properties" class="property-group" style="display: none;">
                        <h4>Recortar</h4>
                        <div class="form-group">
                            <button id="apply-crop" class="action-button primary">
                                <i class="fas fa-check"></i> Aplicar Recorte
                            </button>
                            <button id="cancel-crop" class="action-button">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>

                    <!-- Propriedades de rotação (visível apenas quando ferramenta de rotação ativa) -->
                    <div id="rotate-properties" class="property-group" style="display: none;">
                        <h4>Rotacionar</h4>
                        <div class="form-group">
                            <label for="rotation-angle">Ângulo:</label>
                            <input type="range" id="rotation-angle" min="0" max="360" value="0">
                            <span id="rotation-angle-value">0°</span>
                        </div>
                        <div class="form-group">
                            <button id="rotate-left" class="action-button">
                                <i class="fas fa-undo"></i> 90° Esquerda
                            </button>
                            <button id="rotate-right" class="action-button">
                                <i class="fas fa-redo"></i> 90° Direita
                            </button>
                        </div>
                        <div class="form-group">
                            <button id="apply-rotation" class="action-button primary">
                                <i class="fas fa-check"></i> Aplicar Rotação
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Salvar -->
    <div id="save-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Salvar Imagem</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="save-filename">Nome do arquivo:</label>
                    <input type="text" id="save-filename" placeholder="imagem_editada">
                </div>
                <div class="form-group">
                    <label for="save-format">Formato:</label>
                    <select id="save-format">
                        <option value="webp">WebP (recomendado)</option>
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="save-quality">Qualidade:</label>
                    <input type="range" id="save-quality" min="10" max="100" value="90">
                    <span id="save-quality-value">90%</span>
                </div>
                <div class="preview-container">
                    <h4>Prévia:</h4>
                    <div id="save-preview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirm-save" class="action-button primary">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <button id="cancel-save" class="action-button">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Formas -->
    <div id="shapes-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Selecionar Forma</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="shapes-grid">
                    <div class="shape-item" data-shape="rect">
                        <div class="shape-preview rect"></div>
                        <span>Retângulo</span>
                    </div>
                    <div class="shape-item" data-shape="circle">
                        <div class="shape-preview circle"></div>
                        <span>Círculo</span>
                    </div>
                    <div class="shape-item" data-shape="triangle">
                        <div class="shape-preview triangle"></div>
                        <span>Triângulo</span>
                    </div>
                    <div class="shape-item" data-shape="line">
                        <div class="shape-preview line"></div>
                        <span>Linha</span>
                    </div>
                    <div class="shape-item" data-shape="polygon">
                        <div class="shape-preview polygon"></div>
                        <span>Polígono</span>
                    </div>
                    <div class="shape-item" data-shape="star">
                        <div class="shape-preview star"></div>
                        <span>Estrela</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensagem de Sucesso -->
    <div id="success-message" class="message-popup">
        <i class="fas fa-check-circle"></i>
        <span id="success-text">Imagem salva com sucesso!</span>
    </div>

    <script src="/js/editor.js"></script>
</body>
</html>
